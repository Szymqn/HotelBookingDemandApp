{% extends 'base.html' %}
{% load static %}

{% block title %}Analytics{% endblock %}

{% block content %}
    <h1>Analytics</h1>
    <p>View analytics and reports here.</p>
    <div class="container-fluid">
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Avg. ADR</h5>
                        <p class="card-text">${{ avg_adr }}</p>
                        <p class="card-text fs-7">Average Daily Rate</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Avg. Length of Stay</h5>
                        <p class="card-text">{{ avg_room_occupy }}</p>
                        <p class="card-text fs-7">Nights per booking</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ADR Trends</h5>
                        <p class="card-text">Monthly revenue and booking volume analysis</p>
                        <div id="adrTrendChart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
    const labels = {{ chart_label_json|safe }};
    const adrSeries = {{ chart_adr_json|safe }};

    new ApexCharts(document.querySelector("#adrTrendChart"), {
        chart: {
            type: 'area',
            height: 350,
            toolbar: {
                show: true
            }
        },
        series: [{ name: 'Avg ADR', data: adrSeries }],
        xaxis: {
            categories: labels,
            tickAmount: Math.min(labels.length, 12),
            labels: {
                rotate: -45,
                trim: true
            }
        },
        dataLabels: { enabled: false },
        stroke: { curve: 'smooth', width: 3 },
        fill: {
            type: 'gradient',
            gradient: { shadeIntensity: 1, opacityFrom: 0.45, opacityTo: 0, stops: [0, 100] }
        },
        tooltip: {
            y: { formatter: v => '$' + v.toFixed(2) } },
        yaxis: { labels: { formatter: v => '$' + v } },
        colors: ['#0066ff']
    }).render();
</script>
{% endblock %}